pipeline {
    agent {
       node {
           label 'windows-agent-01'
       }
    }

    stages {
        stage('Build') {
            steps {
                echo 'Building..'
                git branch: 'master',
                    url: 'https://github.com/richard3d/LSystem'
                bat ''' 
                    "C:\\Program Files\\Unity\\Editor\\Unity.exe" -quit -batchmode -projectPath "%WORKSPACE%" -buildWindows64Player "C:\\bin\\richie.exe" -logFile "%WORKSPACE%\\%BUILD_NUMBER%.out"
                    type "%WORKSPACE%\\%BUILD_NUMBER%.out"
                ''' 

                script {
                    def server = Artifactory.newServer('http://10.0.0.11:8082/artifactory', 'admin', 'password')

                    def uploadSpec = """{
                     "files": [
                      {
                          "pattern": "C:/bin/*.exe",
                          "target": "unity/"
                      }
                      ]
                    }"""

                    //def buildInfo = server.upload(uploadSpec)
                    //server.publishBuildInfo buildInfo
                }   

            }   
        }   
        stage('Test') {
            steps {
                echo 'Testing..'
            }   
        }   
        stage('Deploy') {
            steps {
                echo 'Deploying....'
            }   
        }   
    }   
}

